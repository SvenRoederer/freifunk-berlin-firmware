From: Sven Roederer <devel-sven@geroedel.de>
Date: Sat, 2 May 2020 12:33:04 +0200
Subject: freifunk-berlin-generic: import more required definitions after split of luci.mk

diff --git a/freifunk-berlin-generic.mk b/freifunk-berlin-generic.mk
index a5dbd59534841822451b9003b5d905b2bbb33185..eb97dcff9e919352b98eabd0bc6e2f490d5cc90d 100644
--- a/freifunk-berlin-generic.mk
+++ b/freifunk-berlin-generic.mk
@@ -32,4 +32,34 @@ PKG_VERSION?=$(if $(DUMP),x,$(strip $(shell \
 	echo "$$revision" \
 )))
 
+LUCI_NAME?=$(notdir ${CURDIR})
+LUCI_TYPE?=$(word 2,$(subst -, ,$(LUCI_NAME)))
+LUCI_BASENAME?=$(patsubst luci-$(LUCI_TYPE)-%,%,$(LUCI_NAME))
+LUCI_LANGUAGES:=$(sort $(filter-out templates,$(notdir $(wildcard ${CURDIR}/po/*))))
+LUCI_DEFAULTS:=$(notdir $(wildcard ${CURDIR}/root/etc/uci-defaults/*))
+LUCI_PKGARCH?=$(if $(realpath src/Makefile),,all)
+
+PKG_NAME?=$(LUCI_NAME)
+PKG_BUILD_DEPENDS += $(LUCI_BUILD_DEPENDS)
+
 include $(LUCIMKFILE)
+
+define Package/$(PKG_NAME)
+  SECTION:=freifunk-berlin
+  CATEGORY:=freifunk-berlin
+  SUBMENU:=$(if $(LUCI_MENU.$(LUCI_TYPE)),$(LUCI_MENU.$(LUCI_TYPE)),$(LUCI_MENU.app))
+  TITLE:=$(if $(LUCI_TITLE),$(LUCI_TITLE),LuCI $(LUCI_NAME) $(LUCI_TYPE))
+  DEPENDS:=$(LUCI_DEPENDS)
+  VERSION:=$(if $(PKG_VERSION),$(PKG_VERSION),$(PKG_SRC_VERSION))
+  $(if $(LUCI_EXTRA_DEPENDS),EXTRA_DEPENDS:=$(LUCI_EXTRA_DEPENDS))
+  $(if $(LUCI_PKGARCH),PKGARCH:=$(LUCI_PKGARCH))
+endef
+
+ifneq ($(LUCI_DESCRIPTION),)
+ define Package/$(PKG_NAME)/description
+   $(strip $(LUCI_DESCRIPTION))
+ endef
+endif
+
+$(eval $(call BuildPackage,$(PKG_NAME)))
+#$(foreach pkg,$(LUCI_BUILD_PACKAGES),$(eval $(call BuildPackage,$(pkg))))
